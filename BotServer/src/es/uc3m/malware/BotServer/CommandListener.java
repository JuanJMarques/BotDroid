package es.uc3m.malware.BotServer;

import org.eclipse.jetty.client.api.Response;
import org.eclipse.jetty.util.Callback;

import java.nio.ByteBuffer;
import java.util.Arrays;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;
import java.util.logging.Logger;

/**
 * Created by JuanJesÃºs on 13/03/2016.
 */
public class CommandListener implements Response.AsyncContentListener {

    Logger Log = java.util.logging.Logger.getLogger(CommandListener.class.getName());
    @Override
    public void onContent(Response response, ByteBuffer byteBuffer, Callback callback) {
        callback.succeeded();
        final byte[] commandBytes = byteBuffer.array();


    }

    private class CommandHandler{

        private final ExecutorService pool = Executors.newFixedThreadPool(10);
        private static final String TEST_COMMAND = "test";

        public void proccesscommand(byte[] commandBytes) {
            String completeIsntruction = new String(commandBytes);

            String command = null;
            String[] args = null;
            if (completeIsntruction.contains(",")) {
                String[] instructionParts = completeIsntruction.split(",");
                command = instructionParts[0];
                args = Arrays.copyOfRange(instructionParts, 1, instructionParts.length);
            } else {
                command = completeIsntruction;
                args = new String[0];
            }

            switch (command) {
                case TEST_COMMAND:
                    break;
                default:
                    Log.info( "no recognised command" + command + " -> " + completeIsntruction);
            }
        }
    }
}
